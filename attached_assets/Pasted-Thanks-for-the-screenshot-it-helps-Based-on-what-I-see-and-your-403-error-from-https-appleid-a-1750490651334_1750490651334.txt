Thanks for the screenshot â€” it helps. Based on what I see and your 403 error from `https://appleid.apple.com/.well-known/openid-configuration`, the issue is almost certainly related to **one or more of these root causes**:

---

## âœ… High-Likelihood Causes of Apple Login Not Working in Replit

### 1. **Missing or Incorrectly Set Environment Variables**

Replit needs these **exact** values in your Secrets:

| Secret Key           | What It Should Be                                     |
| -------------------- | ----------------------------------------------------- |
| `APPLE_CLIENT_ID`    | `com.soapboxsuperapp.auth` (Service ID)               |
| `APPLE_TEAM_ID`      | Your 10-char Apple Team ID                            |
| `APPLE_KEY_ID`       | From the `.p8` file you downloaded                    |
| `APPLE_PRIVATE_KEY`  | Contents of `.p8` file (copy as string, no newlines)  |
| `APPLE_REDIRECT_URI` | `https://soapboxsuperapp.com/auth/callback` (or test) |

> âœ… Make sure there are **no extra newlines or whitespace** in the `.p8` private key.

---

### 2. **Your Server Doesnâ€™t Support HTTPS (Required by Apple)**

Apple **requires HTTPS**, even for testing. Replit by default uses HTTPS only on its public domain, **not `localhost`**.

**Fix:**

* Test the flow using your **Replit public URL**, not `localhost`

  * e.g. `https://soapbox-super-app.[your-username].repl.co`

Update your redirect URI on Apple Developer Portal to match this if needed.

---

### 3. **Incorrect Apple Strategy Configuration**

Check that your Apple strategy (e.g., `productionAuth.ts` or `passport-apple` config) looks like this:

```ts
const AppleStrategy = require('passport-apple');

passport.use(new AppleStrategy({
  clientID: process.env.APPLE_CLIENT_ID,
  teamID: process.env.APPLE_TEAM_ID,
  keyID: process.env.APPLE_KEY_ID,
  privateKey: process.env.APPLE_PRIVATE_KEY,
  callbackURL: process.env.APPLE_REDIRECT_URI,
  passReqToCallback: true,
}, async (req, accessToken, refreshToken, idToken, profile, done) => {
  // handle user login or signup
}));
```

---

### 4. **Apple Didnâ€™t Approve Your Redirect URI**

Make sure this URL is listed in the **Service ID** setup on Apple Dev Console:

* Log into Apple Developer
* Go to **Identifiers â†’ Service IDs â†’ com.soapboxsuperapp.auth**
* Check that `https://soapboxsuperapp.com/auth/callback` or your **Replit live URL** is registered

---

### ðŸ§ª Debug Tip: Use This Apple URL

To verify Apple is working externally:

```bash
curl https://appleid.apple.com/.well-known/openid-configuration
```

You should get JSON. If that fails from Replit:

* Replitâ€™s outbound IP is being rate-limited or blocked (rare, but possible)
* Use a proxy or deploy externally (e.g., on Render, Vercel, etc.)

---

### âœ… Recommended Next Actions:

1. âœ… Double-check **Replit Secrets** for correct formatting (no extra spaces/newlines in `.p8`)
2. âœ… Use Replitâ€™s **public HTTPS URL** in your redirect URIs
3. âœ… Confirm Apple Dev Console settings match those URLs exactly
4. âœ… Test Appleâ€™s `.well-known` endpoint from **curl locally and from within Replit**

---

Would you like me to inspect your `productionAuth.ts` file logic and correct it for Apple OAuth specifically?
