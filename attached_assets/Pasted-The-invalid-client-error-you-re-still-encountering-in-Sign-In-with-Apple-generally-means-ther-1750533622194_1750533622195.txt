The **“invalid\_client”** error you're still encountering in Sign In with Apple generally means there’s a mismatch between what your app sends and what Apple expects. Let’s troubleshoot it **methodically** using what’s shown in your screenshots:

---

### ✅ Here’s What Looks Correct:

* **Service ID**: `com.soapboxsuperapp.signin` is configured in both Apple Developer Console and in your `APPLE_CLIENT_ID`.
* **Redirect URI**: `https://www.soapboxapp.org/auth/callback` is set in Apple Developer and used in `APPLE_REDIRECT_URI`.
* **Bundle ID**: `com.soapbox.superapp` is fine and doesn’t affect web-based sign-in directly.
* **Team ID**: Present and consistent.

---

### 🔍 Critical Areas to Double-Check:

1. ### 🔐 **Client Secret**

   * This is the most common culprit.
   * It must be:

     * **Signed with your private key** from Apple.
     * Use `client_id = com.soapboxsuperapp.signin`
     * `team_id = CGQ7FW7J58` (from your dev account)
     * `key_id = AJ96FBPJ83` (your active key)
     * `aud = https://appleid.apple.com`
     * `sub = client_id`

   ❗️**Regenerate** your Apple client secret if:

   * You changed the Service ID recently
   * You used the wrong `client_id` or `aud`
   * You didn’t include all claims or signed with wrong key

2. ### ⚙️ `.env` Settings (Double check your secrets)

   Make sure these are precisely correct:

   ```env
   APPLE_CLIENT_ID=com.soapboxsuperapp.signin
   APPLE_REDIRECT_URI=https://www.soapboxapp.org/auth/callback
   APPLE_CLIENT_SECRET=... (Regenerate this)
   ```

3. ### 🌐 Domains Configuration in Apple Developer:

   In the **Sign in with Apple → Configure → Web** section:

   * ✅ Primary domain: `soapboxapp.org`
   * ✅ Subdomain: `www.soapboxapp.org`
   * ✅ Return URL: `https://www.soapboxapp.org/auth/callback`

4. ### 📥 Signed Client Secret Validator

   Run this test on your JWT (client secret):
   Use: [https://jwt.io](https://jwt.io)

   * Paste your `APPLE_CLIENT_SECRET`
   * It should decode cleanly and have:

     ```json
     {
       "iss": "CGQ7FW7J58",
       "iat": ...,
       "exp": ...,
       "aud": "https://appleid.apple.com",
       "sub": "com.soapboxsuperapp.signin"
     }
     ```

---

### ✅ Final Checklist:

| Item                                                       | Status            |
| ---------------------------------------------------------- | ----------------- |
| Service ID in Apple Console = `com.soapboxsuperapp.signin` | ✅                 |
| APPLE\_CLIENT\_ID = `com.soapboxsuperapp.signin`           | ✅                 |
| Redirect URI matches on Apple Console and App              | ✅                 |
| Domain = `soapboxapp.org` with `www.` subdomain            | ✅                 |
| Signed client secret with correct `iss`, `aud`, `sub`      | ❓ (re-check this) |
| Is your Sign In web route publicly accessible?             | ✅ or ❓            |

---

### 🚨 If the issue persists:

You **do not** need to make a new Service ID or Bundle ID if you're using the same identifier (`com.soapboxsuperapp.signin`).
But you **must regenerate** the **Apple client secret** if you changed either the:

* `client_id`
* `key`
* or updated anything in the Apple Developer console related to Sign In.

---

Would you like a script to generate the Apple client secret JWT securely with your credentials?
